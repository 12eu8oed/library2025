<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>LibTime - ë„ì„œê´€ ì‹œê°„ í™•ì¸ ì•±</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: -apple-system, BlinkMacSystemFont, 'Apple SD Gothic Neo', 'Noto Sans KR', sans-serif;
            -webkit-tap-highlight-color: transparent;
        }

        html, body {
            max-width: 768px;
            margin: 0 auto;
            background-color: #f5f5f5;
            min-height: 100vh;
            position: relative;
        }

        header {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            max-width: 768px;
            margin: 0 auto;
            background-color: #2c3e50;
            color: white;
            padding: 15px;
            text-align: center;
            z-index: 1000;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }

        header h1 {
            font-size: 1.3rem;
            margin-bottom: 5px;
        }

        header p {
            font-size: 0.9rem;
            opacity: 0.8;
        }

        .main-content {
            padding: 80px 15px 20px;
        }

        .search-section {
            background-color: white;
            padding: 15px;
            border-radius: 15px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            margin-bottom: 15px;
        }

        .search-input {
            width: 100%;
            padding: 12px 15px;
            border: 1.5px solid #ddd;
            border-radius: 10px;
            font-size: 1rem;
            margin-bottom: 10px;
            -webkit-appearance: none;
        }

        .search-input:focus {
            outline: none;
            border-color: #2c3e50;
        }

        select {
            width: 100%;
            padding: 12px 15px;
            border: 1.5px solid #ddd;
            border-radius: 10px;
            margin-bottom: 10px;
            font-size: 1rem;
            background-color: white;
            -webkit-appearance: none;
            background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='%232c3e50' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6 9 12 15 18 9'%3e%3c/polyline%3e%3c/svg%3e");
            background-repeat: no-repeat;
            background-position: right 15px center;
            background-size: 15px;
        }

        select:focus {
            outline: none;
            border-color: #2c3e50;
        }

        button {
            width: 100%;
            padding: 15px;
            background-color: #2c3e50;
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
        }

        button:active {
            background-color: #34495e;
        }

        .map-container {
            height: 200px;
            border-radius: 15px;
            overflow: hidden;
            margin-bottom: 15px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            position: relative;
        }

        #map {
            height: 100%;
            width: 100%;
        }

        .library-list {
            padding-bottom: 20px;
        }

        .library-card {
            background-color: white;
            padding: 15px;
            border-radius: 15px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            margin-bottom: 15px;
            cursor: pointer;
        }

        .library-card:active {
            transform: scale(0.98);
        }

        .library-name {
            font-size: 1.1rem;
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 10px;
        }

        .status-badge {
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 0.8rem;
            white-space: nowrap;
        }

        .status-open {
            background-color: #27ae60;
            color: white;
        }

        .status-closed {
            background-color: #e74c3c;
            color: white;
        }

        .library-info {
            font-size: 0.9rem;
            color: #666;
            line-height: 1.6;
        }

        .library-info p {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 5px;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 2000;
            overflow-y: auto;
            -webkit-overflow-scrolling: touch;
        }

        .modal-content {
            background-color: #fff;
            margin: 60px 15px 20px;
            border-radius: 15px;
            overflow: hidden;
            position: relative;
            animation: slideUp 0.3s ease-out;
        }

        @keyframes slideUp {
            from { transform: translateY(100%); }
            to { transform: translateY(0); }
        }

        .modal-header {
            padding: 20px;
            background-color: #2c3e50;
            color: white;
            position: relative;
        }

        .modal-title {
            font-size: 1.2rem;
            font-weight: 600;
            margin-right: 40px;
        }

        .close-modal {
            position: absolute;
            top: 50%;
            right: 20px;
            transform: translateY(-50%);
            background: none;
            border: none;
            color: white;
            font-size: 1.5rem;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            padding: 0;
        }

        .detail-map {
            height: 200px;
            width: 100%;
        }

        .detail-info {
            padding: 20px;
        }

        .detail-section {
            background-color: #f8f9fa;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 15px;
        }

        .detail-section:last-child {
            margin-bottom: 0;
        }

        .detail-section h3 {
            font-size: 1.1rem;
            color: #2c3e50;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .detail-item {
            display: flex;
            align-items: flex-start;
            gap: 10px;
            margin-bottom: 8px;
            font-size: 0.95rem;
            color: #666;
        }

        .detail-item:last-child {
            margin-bottom: 0;
        }

        .detail-label {
            flex-shrink: 0;
            width: 24px;
            text-align: center;
        }

        .loading {
            text-align: center;
            padding: 30px;
            color: #666;
            font-size: 1rem;
            background-color: white;
            border-radius: 15px;
            margin-bottom: 15px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }

        .no-results {
            text-align: center;
            padding: 30px;
            color: #666;
            font-size: 1rem;
            background-color: white;
            border-radius: 15px;
            margin-bottom: 15px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }

        @media (min-width: 769px) {
            body {
                background-color: #2c3e50;
            }

            body > div {
                background-color: #f5f5f5;
                min-height: 100vh;
            }
        }

        .filter-button {
            width: 100%;
            padding: 15px;
            background-color: #2c3e50;
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 1rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 10px;
        }

        .filter-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease-out;
        }

        .filter-content.show {
            max-height: 1000px;
            transition: max-height 0.3s ease-in;
        }

        .filter-group {
            margin-bottom: 15px;
        }

        .arrow {
            transition: transform 0.3s;
        }

        .arrow.up {
            transform: rotate(180deg);
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>LibTime</h1>
            <p>ê°€ê¹Œìš´ ë„ì„œê´€ ìš´ì˜ì‹œê°„ í™•ì¸</p>
        </header>

        <div class="main-content">
            <div class="search-section">
                <button class="filter-button" onclick="toggleFilters()">
                    ê²€ìƒ‰ í•„í„°
                    <span class="arrow">â–¼</span>
                </button>
                <div class="filter-content">
                    <div class="filter-group">
                        <input type="text" class="search-input" id="libraryName" placeholder="ë„ì„œê´€ ì´ë¦„ ê²€ìƒ‰">

                        <select id="sido" onchange="updateSigungu()">
                            <option value="">ì‹œ/ë„ ì„ íƒ</option>
                            <option value="ì„œìš¸íŠ¹ë³„ì‹œ">ì„œìš¸íŠ¹ë³„ì‹œ</option>
                            <option value="ë¶€ì‚°ê´‘ì—­ì‹œ">ë¶€ì‚°ê´‘ì—­ì‹œ</option>
                            <option value="ëŒ€êµ¬ê´‘ì—­ì‹œ">ëŒ€êµ¬ê´‘ì—­ì‹œ</option>
                            <option value="ì¸ì²œê´‘ì—­ì‹œ">ì¸ì²œê´‘ì—­ì‹œ</option>
                            <option value="ê´‘ì£¼ê´‘ì—­ì‹œ">ê´‘ì£¼ê´‘ì—­ì‹œ</option>
                            <option value="ëŒ€ì „ê´‘ì—­ì‹œ">ëŒ€ì „ê´‘ì‹œ</option>
                            <option value="ìš¸ì‚°ê´‘ì—­ì‹œ">ìš¸ì‚°ê´‘ì—­ì‹œ</option>
                            <option value="ì„¸ì¢…íŠ¹ë³„ìì¹˜ì‹œ">ì„¸ì¢…íŠ¹ë³„ìì¹˜ì‹œ</option>
                            <option value="ê²½ê¸°ë„">ê²½ê¸°ë„</option>
                            <option value="ê°•ì›ë„">ê°•ì›ë„</option>
                            <option value="ì¶©ì²­ë¶ë„">ì¶©ì²­ë¶ë„</option>
                            <option value="ì¶©ì²­ë‚¨ë„">ì¶©ì²­ë‚¨ë„</option>
                            <option value="ì „ë¼ë¶ë„">ì „ë¼ë¶ë„</option>
                            <option value="ì „ë¼ë‚¨ë„">ì „ë¼ë‚¨ë„</option>
                            <option value="ê²½ìƒë¶ë„">ê²½ìƒë¶ë„</option>
                            <option value="ê²½ìƒë‚¨ë„">ê²½ìƒë‚¨ë„</option>
                            <option value="ì œì£¼íŠ¹ë³„ìì¹˜ë„">ì œì£¼íŠ¹ë³„ìì¹˜ë„</option>
                        </select>

                        <select id="sigungu">
                            <option value="">ì‹œ/êµ°/êµ¬ ì„ íƒ</option>
                        </select>

                        <select id="weekdayTime">
                            <option value="">í‰ì¼ ìš´ì˜ì‹œê°„ ì„ íƒ</option>
                            <option value="13:00">13ì‹œê¹Œì§€</option>
                            <option value="14:00">14ì‹œê¹Œì§€</option>
                            <option value="15:00">15ì‹œê¹Œì§€</option>
                            <option value="16:00">16ì‹œê¹Œì§€</option>
                            <option value="17:00">17ì‹œê¹Œì§€</option>
                            <option value="18:00">18ì‹œê¹Œì§€</option>
                            <option value="19:00">19ì‹œê¹Œì§€</option>
                            <option value="20:00">20ì‹œê¹Œì§€</option>
                            <option value="21:00">21ì‹œê¹Œì§€</option>
                            <option value="22:00">22ì‹œê¹Œì§€</option>
                            <option value="23:00">23ì‹œê¹Œì§€</option>
                        </select>

                        <select id="weekendTime">
                            <option value="">ì£¼ë§ ìš´ì˜ì‹œê°„ ì„ íƒ</option>
                            <option value="13:00">13ì‹œê¹Œì§€</option>
                            <option value="14:00">14ì‹œê¹Œì§€</option>
                            <option value="15:00">15ì‹œê¹Œì§€</option>
                            <option value="16:00">16ì‹œê¹Œì§€</option>
                            <option value="17:00">17ì‹œê¹Œì§€</option>
                            <option value="18:00">18ì‹œê¹Œì§€</option>
                            <option value="19:00">19ì‹œê¹Œì§€</option>
                            <option value="20:00">20ì‹œê¹Œì§€</option>
                            <option value="21:00">21ì‹œê¹Œì§€</option>
                            <option value="22:00">22ì‹œê¹Œì§€</option>
                            <option value="23:00">23ì‹œê¹Œì§€</option>
                        </select>

                        <select id="closeDay">
                            <option value="">íœ´ê´€ì¼ ì„ íƒ</option>
                            <option value="ì›”">ì›”ìš”ì¼</option>
                            <option value="í™”">í™”ìš”ì¼</option>
                            <option value="ìˆ˜">ìˆ˜ìš”ì¼</option>
                            <option value="ëª©">ëª©ìš”ì¼</option>
                            <option value="ê¸ˆ">ê¸ˆìš”ì¼</option>
                            <option value="í† ">í† ìš”ì¼</option>
                            <option value="ì¼">ì¼ìš”ì¼</option>
                        </select>
                    </div>
                    <button onclick="searchLibraries()">ë„ì„œê´€ ê²€ìƒ‰</button>
                </div>
            </div>

            <div class="map-container">
                <div id="map"></div>
            </div>

            <div id="results" class="library-list">
                <!-- ê²€ìƒ‰ ê²°ê³¼ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤ -->
            </div>
        </div>
    </div>

    <!-- ëª¨ë‹¬ -->
    <div id="libraryModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">ë„ì„œê´€ ìƒì„¸ ì •ë³´</h2>
                <button class="close-modal" onclick="closeModal()">Ã—</button>
            </div>
            <div class="modal-body">
                <div id="detailMap" class="detail-map"></div>
                <div class="detail-info">
                    <div class="detail-section">
                        <h3>ğŸ“ ìœ„ì¹˜ ì •ë³´</h3>
                        <div id="locationInfo"></div>
                    </div>
                    <div class="detail-section">
                        <h3>â° ìš´ì˜ ì‹œê°„</h3>
                        <div id="operationInfo"></div>
                    </div>
                    <div class="detail-section">
                        <h3>ğŸ“š ë„ì„œê´€ ì •ë³´</h3>
                        <div id="libraryInfo"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ì§€ë„ ì´ˆê¸°í™”
        const map = L.map('map').setView([37.5665, 126.9780], 13);
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
        }).addTo(map);

        let markers = [];
        let detailMap = null;

        const sigunguData = {
            "ì„œìš¸íŠ¹ë³„ì‹œ": ["ê°•ë‚¨êµ¬", "ê°•ë™êµ¬", "ê°•ë¶êµ¬", "ê°•ì„œêµ¬", "ê´€ì•…êµ¬", "ê´‘ì§„êµ¬", "êµ¬ë¡œêµ¬", "ê¸ˆì²œêµ¬", "ë…¸ì›êµ¬", "ë„ë´‰êµ¬", "ë™ëŒ€ë¬¸êµ¬", "ë™ì‘êµ¬", "ë§ˆí¬êµ¬", "ì„œëŒ€ë¬¸êµ¬", "ì„œì´ˆêµ¬", "ì„±ë™êµ¬", "ì„±ë¶êµ¬", "ì†¡íŒŒêµ¬", "ì–‘ì²œêµ¬", "ì˜ë“±í¬êµ¬", "ìš©ì‚°êµ¬", "ì€í‰êµ¬", "ì¢…ë¡œêµ¬", "ì¤‘êµ¬", "ì¤‘ë‘êµ¬"],
            "ë¶€ì‚°ê´‘ì—­ì‹œ": ["ê°•ì„œêµ¬", "ê¸ˆì •êµ¬", "ë‚¨êµ¬", "ë™êµ¬", "ë™ë˜êµ¬", "ë¶€ì‚°ì§„êµ¬", "ë¶êµ¬", "ì‚¬ìƒêµ¬", "ì‚¬í•˜êµ¬", "ì„œêµ¬", "ìˆ˜êµ¬", "ì—°ì œêµ¬", "ì˜ë„êµ¬", "ì¤‘êµ¬", "í•´ìš´ëŒ€êµ¬", "ê¸°ì¥êµ°"],
            "ëŒ€êµ¬ê´‘ì—­ì‹œ": ["ë‚¨êµ¬", "ë‹¬ì„œêµ¬", "ë™êµ¬", "ë¶êµ¬", "ì„œêµ¬", "ìˆ˜ì„±êµ¬", "ì¤‘êµ¬", "ë‹¬ì„±êµ°"],
            "ì¸ì²œê´‘ì—­ì‹œ": ["ê³„ì–‘êµ¬", "ë‚¨ë™êµ¬", "ë™êµ¬", "ë¯¸ì¶”í™€êµ¬", "ë¶€í‰êµ¬", "ì„œêµ¬", "ì—°ìˆ˜êµ¬", "ì¤‘êµ¬", "ê°•í™”êµ°", "ì˜¹ì§„êµ°"],
            "ê´‘ì£¼ê´‘ì—­ì‹œ": ["ê´‘ì‚°êµ¬", "ë‚¨êµ¬", "ë™êµ¬", "ë¶êµ¬", "ì„œêµ¬"],
            "ëŒ€ì „ê´‘ì—­ì‹œ": ["ëŒ€ë•êµ¬", "ë™êµ¬", "ì„œêµ¬", "ìœ ì„±êµ¬", "ì¤‘êµ¬"],
            "ìš¸ì‚°ê´‘ì—­ì‹œ": ["ë‚¨êµ¬", "ë™êµ¬", "ë¶êµ¬", "ì¤‘êµ¬", "ìš¸ì£¼êµ°"],
            "ì„¸ì¢…íŠ¹ë³„ìì¹˜ì‹œ": ["ì„¸ì¢…ì‹œ"],
            "ê²½ê¸°ë„": ["ê³ ì–‘ì‹œ", "ê³¼ì²œì‹œ", "ê´‘ëª…ì‹œ", "ê´‘ì£¼ì‹œ", "êµ¬ë¦¬ì‹œ", "êµ°í¬ì‹œ", "ê¹€í¬ì‹œ", "ë‚¨ì–‘ì£¼ì‹œ", "ë™ë‘ì²œì‹œ", "ë¶€ì²œì‹œ", "ì„±ë‚¨ì‹œ", "ìˆ˜ì›ì‹œ", "ì‹œí¥ì‹œ", "ì•ˆì‚°ì‹œ", "ì•ˆì„±ì‹œ", "ì•ˆì–‘ì‹œ", "ì–‘ì£¼ì‹œ", "ì˜¤ì‚°ì‹œ", "ìš©ì¸ì‹œ", "ì˜ì™•ì‹œ", "ì˜ì •ë¶€ì‹œ", "ì´ì²œì‹œ", "íŒŒì£¼ì‹œ", "í‰íƒì‹œ", "í¬ì²œì‹œ", "í•˜ë‚¨ì‹œ", "í™”ì„±ì‹œ", "ê°€í‰êµ°", "ì–‘í‰êµ°", "ì—¬ì£¼ì‹œ", "ì—°ì²œêµ°"],
            "ê°•ì›ë„": ["ê°•ë¦‰ì‹œ", "ë™í•´ì‹œ", "ì‚¼ì²™ì‹œ", "ì†ì´ˆì‹œ", "ì›ì£¼ì‹œ", "ì¶˜ì²œì‹œ", "íƒœë°±ì‹œ", "ê³ ì„±êµ°", "ì–‘êµ¬êµ°", "ì–‘ì–‘êµ°", "ì˜ì›”êµ°", "ì¸ì œêµ°", "ì •ì„ êµ°", "ì² ì›êµ°", "í‰ì°½êµ°", "í™ì²œêµ°", "í™”ì²œêµ°", "íš¡ì„±êµ°"],
            "ì¶©ì²­ë¶ë„": ["ì œì²œì‹œ", "ì²­ì£¼ì‹œ", "ì¶©ì£¼ì‹œ", "ê´´ì‚°êµ°", "ë‹¨ì–‘êµ°", "ë³´ì€êµ°", "ì˜ë™êµ°", "ì˜¥ì²œêµ°", "ìŒì„±êµ°", "ì¦í‰êµ°", "ì§„ì²œêµ°"],
            "ì¶©ì²­ë‚¨ë„": ["ê³„ë£¡ì‹œ", "ê³µì£¼ì‹œ", "ë…¼ì‚°ì‹œ", "ë‹¹ì§„ì‹œ", "ë³´ë ¹ì‹œ", "ì„œì‚°ì‹œ", "ì•„ì‚°ì‹œ", "ì²œì•ˆì‹œ", "ê¸ˆì‚°êµ°", "ë¶€ì—¬êµ°", "ì„œì²œêµ°", "ì˜ˆì‚°êµ°", "ì²­ì–‘êµ°", "íƒœì•ˆêµ°", "í™ì„±êµ°"],
            "ì „ë¼ë¶ë„": ["êµ°ì‚°ì‹œ", "ê¹€ì œì‹œ", "ë‚¨ì›ì‹œ", "ìµì‚°ì‹œ", "ì „ì£¼ì‹œ", "ì •ìì‹œ", "ê³ ì°½êµ°", "ë¬´ì£¼êµ°", "ë¶€ì•ˆêµ°", "ìˆœì°½êµ°", "ì™„ì£¼êµ°", "ì„ì‹¤êµ°", "ì¥ìˆ˜êµ°", "ì§„ì•ˆêµ°"],
            "ì „ë¼ë‚¨ë„": ["ê´‘ì–‘ì‹œ", "ë‚˜ì£¼ì‹œ", "ëª©í¬ì‹œ", "ìˆœì²œì‹œ", "ì—¬ìˆ˜ì‹œ", "ê°•ì§„êµ°", "ê³ í¥êµ°", "ê³¡ì„±êµ°", "êµ¬ë¡€êµ°", "ë‹´ì–‘êµ°", "ë¬´ì•ˆêµ°", "ë³´ì„±êµ°", "ì‹ ì•ˆêµ°", "ì˜ê´‘êµ°", "ì˜ì•”êµ°", "ì™„ë„êµ°", "ì¥ì„±êµ°", "ì¥í¥êµ°", "ì§„ë„êµ°", "í•¨í‰êµ°", "í•´ë‚¨êµ°", "í™”ìˆœêµ°"],
            "ê²½ìƒë¶ë„": ["ê²½ì‚°ì‹œ", "ê²½ì£¼ì‹œ", "êµ¬ë¯¸ì‹œ", "ê¹€ì²œì‹œ", "ë¬¸ê²½ì‹œ", "ìƒì£¼ì‹œ", "ì•ˆì–‘ì‹œ", "ì˜ì£¼ì‹œ", "ì˜ì²œì‹œ", "í¬í•­ì‹œ", "ê³ ë ¹êµ°", "êµ°ìœ„êµ°", "ë´‰í™”êµ°", "ì„±ì£¼êµ°", "ì˜ë•êµ°", "ì˜ì–‘êµ°", "ì˜ˆì²œêµ°", "ìš¸ë¦‰êµ°", "ìš¸ì§„êµ°", "ì˜ì„±êµ°", "ì²­ë„êµ°", "ì²­ì†¡êµ°", "ì¹ ê³¡êµ°"],
            "ê²½ìƒë‚¨ë„": ["ê±°ì œì‹œ", "ê¹€í•´ì‹œ", "ë°€ì–‘ì‹œ", "ì‚¬ì²œì‹œ", "ì–‘ì‚°ì‹œ", "ì§„ì£¼ì‹œ", "ì°½ì›ì‹œ", "í†µì˜ì‹œ", "ê±°ì°½êµ°", "ê³ ì„±êµ°", "ë‚¨í•´êµ°", "ì‚°ì²­êµ°", "ì˜ì°½êµ°", "ì°½ë…•êµ°", "í•˜ë™êµ°", "í•¨ì•ˆêµ°", "í•¨ì–‘êµ°", "í•©ì²œêµ°"],
            "ì œì£¼íŠ¹ë³„ìì¹˜ë„": ["ì œì£¼ì‹œ", "ì„œê·€í¬ì‹œ"]
        };

        function updateSigungu() {
            const sido = document.getElementById('sido').value;
            const sigunguSelect = document.getElementById('sigungu');
            
            sigunguSelect.innerHTML = '<option value="">ì‹œ/êµ°/êµ¬ ì„ íƒ</option>';
            
            if (sido && sigunguData[sido]) {
                sigunguData[sido].forEach(sigungu => {
                    const option = document.createElement('option');
                    option.value = sigungu;
                    option.textContent = sigungu;
                    sigunguSelect.appendChild(option);
                });
            }
        }

        function toggleFilters() {
            const filterContent = document.querySelector('.filter-content');
            const arrow = document.querySelector('.arrow');
            filterContent.classList.toggle('show');
            arrow.classList.toggle('up');
        }

        async function searchLibraries() {
            const libraryName = document.getElementById('libraryName').value;
            const sido = document.getElementById('sido').value;
            const sigungu = document.getElementById('sigungu').value;
            const weekdayTime = document.getElementById('weekdayTime').value;
            const weekendTime = document.getElementById('weekendTime').value;
            const closeDay = document.getElementById('closeDay').value;

            const serviceKey = 'PBIpP/4F7bIX49M48pfiKnpB91ZqeeFNiUcNLLCXtbaHIVFuMVF+rGv0MQnSHbdY7QK4UW1lvRgdBtAjz4qeEQ==';
            
            let url = `http://api.data.go.kr/openapi/tn_pubr_public_lbrry_api`;
            url += `?serviceKey=${encodeURIComponent(serviceKey)}`;
            url += `&pageNo=0&numOfRows=1000&type=json`;
            
            if (libraryName) url += `&lbrryNm=${encodeURIComponent(libraryName)}`;
            if (sido) url += `&CTPRVN_NM=${encodeURIComponent(sido)}`;
            if (sigungu) url += `&SIGNGU_NM=${encodeURIComponent(sigungu)}`;
            if (weekdayTime) url += `&weekdayOperColseHhmm=${weekdayTime}`;
            if (weekendTime) url += `&satOperCloseHhmm=${weekendTime}`;

            const resultsDiv = document.getElementById('results');
            resultsDiv.innerHTML = '<div class="loading">ê²€ìƒ‰ì¤‘...</div>';

            try {
                const response = await fetch(url);
                const data = await response.json();
                let libraries = data.response.body.items;

                // íœ´ê´€ì¼ í•„í„°ë§
                if (closeDay && libraries) {
                    libraries = libraries.filter(lib => 
                        lib.closeDay && lib.closeDay.includes(closeDay)
                    );
                }

                displayResults(libraries || []);
            } catch (error) {
                console.error('Error:', error);
                resultsDiv.innerHTML = '<div class="no-results">ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.</div>';
            }
        }

        function showModal(library) {
            const modal = document.getElementById('libraryModal');
            modal.style.display = 'block';
            document.body.style.overflow = 'hidden';

            // ëª¨ë‹¬ ì œëª© ì„¤ì •
            document.querySelector('.modal-title').textContent = library.lbrryNm;

            // ìœ„ì¹˜ ì •ë³´ ì„¤ì •
            const locationInfo = document.getElementById('locationInfo');
            locationInfo.innerHTML = `
                <div class="detail-item">
                    <span class="detail-label">ğŸ“</span>
                    <span>${library.rdnmadr || library.lnmadr}</span>
                </div>
                <div class="detail-item">
                    <span class="detail-label">ğŸ“</span>
                    <span>${library.phoneNumber}</span>
                </div>
            `;

            // ìš´ì˜ ì‹œê°„ ì •ë³´ ì„¤ì •
            const operationInfo = document.getElementById('operationInfo');
            operationInfo.innerHTML = `
                <div class="detail-item">
                    <span class="detail-label">ğŸŒ</span>
                    <span>í‰ì¼: ${library.weekdayOperOpenHhmm} - ${library.weekdayOperColseHhmm}</span>
                </div>
                <div class="detail-item">
                    <span class="detail-label">ğŸŒ…</span>
                    <span>ì£¼ë§: ${library.satOperOperOpenHhmm || 'íœ´ê´€'} - ${library.satOperCloseHhmm || 'íœ´ê´€'}</span>
                </div>
                <div class="detail-item">
                    <span class="detail-label">ğŸš«</span>
                    <span>íœ´ê´€ì¼: ${library.closeDay}</span>
                </div>
            `;

            // ë„ì„œê´€ ì •ë³´ ì„¤ì •
            const libraryInfo = document.getElementById('libraryInfo');
            libraryInfo.innerHTML = `
                <div class="detail-item">
                    <span class="detail-label">ğŸ’º</span>
                    <span>ì¢Œì„ìˆ˜: ${library.seatCo}ì„</span>
                </div>
                <div class="detail-item">
                    <span class="detail-label">ğŸ“š</span>
                    <span>ì¥ì„œìˆ˜: ${library.bookCo}ê¶Œ</span>
                </div>
                <div class="detail-item">
                    <span class="detail-label">ğŸ¢</span>
                    <span>ìš´ì˜ê¸°ê´€: ${library.operInstitutionNm}</span>
                </div>
            `;

            // ì§€ë„ ì´ˆê¸°í™” ë° í‘œì‹œ
            if (!detailMap) {
                detailMap = L.map('detailMap');
                L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                    attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
                }).addTo(detailMap);
            }

            if (library.latitude && library.longitude) {
                const latLng = [library.latitude, library.longitude];
                detailMap.setView(latLng, 16);
                L.marker(latLng).addTo(detailMap);
            }

            setTimeout(() => {
                detailMap.invalidateSize();
            }, 100);
        }

        function closeModal() {
            const modal = document.getElementById('libraryModal');
            modal.style.display = 'none';
            document.body.style.overflow = '';
        }

        window.onclick = function(event) {
            const modal = document.getElementById('libraryModal');
            if (event.target === modal) {
                closeModal();
            }
        }

        function isLibraryOpen(library) {
            const now = new Date();
            const hour = now.getHours();
            const minute = now.getMinutes();
            const currentTime = `${hour.toString().padStart(2, '0')}:${minute.toString().padStart(2, '0')}`;
            const day = now.getDay();
            
            const isWeekend = day === 0 || day === 6;
            const openTime = isWeekend ? library.satOperOperOpenHhmm : library.weekdayOperOpenHhmm;
            const closeTime = isWeekend ? library.satOperCloseHhmm : library.weekdayOperColseHhmm;
            
            return currentTime >= openTime && currentTime <= closeTime;
        }

        function clearMarkers() {
            markers.forEach(marker => map.removeLayer(marker));
            markers = [];
        }

        function addMarker(library) {
            if (library.latitude && library.longitude) {
                const marker = L.marker([library.latitude, library.longitude])
                    .bindPopup(`
                        <b>${library.lbrryNm}</b><br>
                        ${library.rdnmadr || library.lnmadr}<br>
                        í‰ì¼: ${library.weekdayOperOpenHhmm} - ${library.weekdayOperColseHhmm}
                    `);
                markers.push(marker);
                marker.addTo(map);
            }
        }

        function displayResults(libraries) {
            const resultsDiv = document.getElementById('results');
            resultsDiv.innerHTML = '';

            clearMarkers();

            if (!libraries || libraries.length === 0) {
                resultsDiv.innerHTML = '<div class="no-results">ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤</div>';
                return;
            }

            const bounds = [];

            libraries.forEach(library => {
                const isOpen = isLibraryOpen(library);
                const card = document.createElement('div');
                card.className = 'library-card';

                if (library.latitude && library.longitude) {
                    bounds.push([library.latitude, library.longitude]);
                }

                card.onclick = () => {
                    showModal(library);
                };

                card.innerHTML = `
                    <div class="library-name">
                        <span class="library-type">${library.lbrrySe || 'ë„ì„œê´€'}</span>
                        ${library.lbrryNm}
                        <span class="status-badge ${isOpen ? 'status-open' : 'status-closed'}">
                            ${isOpen ? 'ìš´ì˜ì¤‘' : 'íœ´ê´€ì¤‘'}
                        </span>
                    </div>
                    <div class="operation-hours">
                        <div class="library-info">
                            <span>â°</span> í‰ì¼: ${library.weekdayOperOpenHhmm} - ${library.weekdayOperColseHhmm}
                        </div>
                        <div class="library-info">
                            <span>ğŸ“…</span> í† ìš”ì¼: ${library.satOperOperOpenHhmm || 'íœ´ê´€'} - ${library.satOperCloseHhmm || 'íœ´ê´€'}
                        </div>
                        <div class="library-info">
                            <span>ğŸš«</span> íœ´ê´€ì¼: ${library.closeDay || 'ì •ë³´ì—†ìŒ'}
                        </div>
                    </div>
                    <div class="library-info">
                        <span>ğŸ“</span> ${library.rdnmadr || library.lnmadr || 'ì£¼ì†Œ ì •ë³´ ì—†ìŒ'}
                    </div>
                    <div class="library-info">
                        <span>ğŸ“</span> ${library.phoneNumber || 'ì •ë³´ì—†ìŒ'}
                    </div>
                `;

                resultsDiv.appendChild(card);
                addMarker(library);
            });

            if (bounds.length > 0) {
                map.fitBounds(bounds);
            }
        }
    </script>
</body>
</html> 